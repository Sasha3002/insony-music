{% extends "users/base.html" %}
{% load static %}
{% block global_messages %}{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/users.css' %}">
{% endblock %}

{% block content %}

<div class="row justify-content-center mt-5">
  <div class="col-sm-10 col-md-8 col-lg-5">
    <div class="auth-card shadow-sm p-4">
      <div class="text-center mb-3">
        <h3 class="auth-brand fw-bold mb-1">Utwórz konto</h3>
        <p class="auth-sub mb-0">Dołącz do społeczności Insony</p>
      </div>

      {% if form.non_field_errors %}
        <div class="alert alert-isony alert-dismissible fade show py-2 px-3 mb-3" role="alert">
          <i class="bi bi-exclamation-triangle me-2"></i>
          {% for e in form.non_field_errors %}<div>{{ e|striptags }}</div>{% endfor %}
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endif %}

      <form method="post" novalidate>
        {% csrf_token %}

        {# Username #}
        <div class="mb-3">
          <label class="form-label">Username</label>
          <div class="input-group has-validation">
            <span class="input-group-text"><i class="bi bi-person"></i></span>
            <input
              type="text" name="username" autocomplete="username"
              class="form-control {% if form.username.errors %}is-invalid{% endif %}"
              placeholder="Twoja nazwa użytkownika"
              value="{{ form.username.value|default_if_none:'' }}">
            {% if form.username.errors %}
              <div class="invalid-feedback d-block">
                {% for e in form.username.errors %}
                  <div>{{ e|striptags }}</div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>

        {# Email #}
        <div class="mb-3">
          <label class="form-label">Email</label>
          <div class="input-group has-validation">
            <span class="input-group-text"><i class="bi bi-envelope"></i></span>
            <input
              type="email" name="email" autocomplete="email"
              class="form-control {% if form.email.errors %}is-invalid{% endif %}"
              placeholder="name@example.com"
              value="{{ form.email.value|default_if_none:'' }}">
            {% if form.email.errors %}
              <div class="invalid-feedback d-block">
                {% for e in form.email.errors %}
                  <div>{{ e|striptags }}</div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>

        {# Hasło #}
        <div class="mb-3">
          <label class="form-label">Hasło</label>
          <div class="input-group has-validation">
            <span class="input-group-text"><i class="bi bi-lock"></i></span>
            <input id="regPassword1"
                   type="password" name="password1" autocomplete="new-password"
                   class="form-control {% if form.password1.errors %}is-invalid{% endif %}"
                   placeholder="Min. 8 znaków (litery i cyfry)">
            <button class="btn btn-outline-secondary" type="button" aria-label="Pokaż/ukryj hasło"
                    onclick="(function(btn){const i=btn.querySelector('i');const f=document.getElementById('regPassword1');if(f.type==='password'){f.type='text';i.className='bi bi-eye-slash';}else{f.type='password';i.className='bi bi-eye';}})(this)">
              <i class="bi bi-eye"></i>
            </button>
            {% if form.password1.errors %}
              <div class="invalid-feedback d-block">
                {% for e in form.password1.errors %}
                  <div>{{ e|striptags }}</div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>

        {# Powtórz hasło #}
        <div class="mb-3">
          <label class="form-label">Powtórz hasło</label>
          <div class="input-group has-validation">
            <span class="input-group-text"><i class="bi bi-lock"></i></span>
            <input id="regPassword2"
                   type="password" name="password2" autocomplete="new-password"
                   class="form-control {% if form.password2.errors %}is-invalid{% endif %}"
                   placeholder="Powtórz hasło">
            <button class="btn btn-outline-secondary" type="button" aria-label="Pokaż/ukryj hasło"
                    onclick="(function(btn){const i=btn.querySelector('i');const f=document.getElementById('regPassword2');if(f.type==='password'){f.type='text';i.className='bi bi-eye-slash';}else{f.type='password';i.className='bi bi-eye';}})(this)">
              <i class="bi bi-eye"></i>
            </button>
            {% if form.password2.errors %}
              <div class="invalid-feedback d-block">
                {% for e in form.password2.errors %}
                  <div>{{ e|striptags }}</div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>

        {# Regulamin #}
        <div class="form-check mb-3">
          <input class="form-check-input {% if form.accept_terms.errors %}is-invalid{% endif %}"
                 type="checkbox"
                 id="acceptTerms"
                 name="accept_terms"
                 {% if form.accept_terms.value %}checked{% endif %}>
          <label class="form-check-label" for="acceptTerms">
            Akceptuję regulamin Insony
          </label>
          {% if form.accept_terms.errors %}
            <div class="invalid-feedback d-block">
              {% for e in form.accept_terms.errors %}
                <div>{{ e|striptags }}</div>
              {% endfor %}
            </div>
          {% endif %}
        </div>

        <button class="btn btn-primary w-100" type="submit">Zarejestruj się</button>
      </form>

      <hr class="my-4">
      <p class="mb-0 text-center auth-sub">
        Masz już konto?
        <a class="auth-link" href="{% url 'login' %}">Zaloguj się</a>
      </p>
    </div>
  </div>
</div>
{% endblock %}
