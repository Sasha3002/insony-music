{% extends "users/base.html" %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/users.css' %}">
{% endblock %}

{% block content %}

<div class="container py-4">
  
  <div class="admin-reports-header">
    <h1 class="admin-reports-title">
      <i class="bi bi-shield-check"></i>
      Panel zgłoszeń
    </h1>
    <p class="admin-reports-subtitle">Zarządzaj zgłoszeniami użytkowników</p>
  </div>

  <!-- Filter Tabs -->
  <div class="filter-tabs">
    <a href="?status=all" class="filter-tab {% if status_filter == 'all' %}active{% endif %}">
      <i class="bi bi-list"></i>
      Wszystkie
      <span class="filter-badge">{{ pending_count|add:in_progress_count|add:resolved_count }}</span>
    </a>
    <a href="?status=pending" class="filter-tab {% if status_filter == 'pending' %}active{% endif %}">
      <i class="bi bi-clock"></i>
      Oczekujące
      <span class="filter-badge">{{ pending_count }}</span>
    </a>
    <a href="?status=in_progress" class="filter-tab {% if status_filter == 'in_progress' %}active{% endif %}">
      <i class="bi bi-gear"></i>
      W trakcie
      <span class="filter-badge">{{ in_progress_count }}</span>
    </a>
    <a href="?status=resolved" class="filter-tab {% if status_filter == 'resolved' %}active{% endif %}">
      <i class="bi bi-check-circle"></i>
      Rozwiązane
      <span class="filter-badge">{{ resolved_count }}</span>
    </a>
  </div>

  <!-- Reports List -->
  {% for report in page_obj %}
    <div class="admin-report-card" onclick="window.location.href='{% url 'admin_report_detail' report.id %}'">
      <div class="admin-report-header">
        <div style="flex: 1;">
          <div class="admin-report-title">{{ report.title }}</div>
          <div class="admin-report-user">
            <i class="bi bi-person-circle"></i>
            {{ report.user.username }}
          </div>
        </div>
        <span class="report-status-badge status-{{ report.status }}">
          {% if report.status == 'pending' %}
            <i class="bi bi-clock"></i> Oczekujący
          {% elif report.status == 'in_progress' %}
            <i class="bi bi-gear"></i> W trakcie
          {% else %}
            <i class="bi bi-check-circle"></i> Rozwiązany
          {% endif %}
        </span>
      </div>

      <div class="admin-report-description">
        {{ report.description|truncatewords:30 }}
      </div>

      <div class="admin-report-meta">
        <span>
          <i class="bi bi-calendar3"></i>
          {{ report.created_at|date:"d.m.Y H:i" }}
        </span>
        {% if report.page_url %}
          <span>
            <i class="bi bi-link"></i>
            {{ report.page_url|truncatechars:50 }}
          </span>
        {% endif %}
        {% if report.resolved_by %}
          <span>
            <i class="bi bi-person-check"></i>
            Rozwiązane przez: {{ report.resolved_by.username }}
          </span>
        {% endif %}
      </div>
    </div>
  {% empty %}
    <div style="text-align: center; padding: 80px 20px; color: #6b7280;">
      <i class="bi bi-inbox" style="font-size: 64px; margin-bottom: 20px; opacity: 0.3;"></i>
      <h3 style="color: #9aa0a6;">Brak zgłoszeń</h3>
    </div>
  {% endfor %}

  <!-- Pagination -->
  {% if page_obj.has_other_pages %}
    <div class="pagination">
      {% if page_obj.has_previous %}
        <a href="?status={{ status_filter }}&page=1">
          <i class="bi bi-chevron-double-left"></i>
        </a>
        <a href="?status={{ status_filter }}&page={{ page_obj.previous_page_number }}">
          <i class="bi bi-chevron-left"></i>
        </a>
      {% endif %}

      <span class="current">{{ page_obj.number }}</span>

      {% if page_obj.has_next %}
        <a href="?status={{ status_filter }}&page={{ page_obj.next_page_number }}">
          <i class="bi bi-chevron-right"></i>
        </a>
        <a href="?status={{ status_filter }}&page={{ page_obj.paginator.num_pages }}">
          <i class="bi bi-chevron-double-right"></i>
        </a>
      {% endif %}
    </div>
  {% endif %}

</div>

{% endblock %}