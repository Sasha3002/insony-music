{% extends "users/base.html" %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/users.css' %}">
{% endblock %}

{% block content %}

<div class="delete-container">
  
  <div class="delete-card">
    <div class="delete-header">
      <div class="delete-icon">
        <i class="bi bi-exclamation-triangle-fill"></i>
      </div>
      <h1 class="delete-title">Usuń konto</h1>
      <p class="delete-subtitle">Ta operacja jest nieodwracalna</p>
    </div>

    <div class="warning-box">
      <h5>
        <i class="bi bi-info-circle-fill"></i>
        Co zostanie usunięte:
      </h5>
      <ul class="warning-list">
        <li>
          <i class="bi bi-x-circle"></i>
          Wszystkie Twoje recenzje i oceny
        </li>
        <li>
          <i class="bi bi-x-circle"></i>
          Wszystkie playlisty i ulubione utwory
        </li>
        <li>
          <i class="bi bi-x-circle"></i>
          Obserwujący i obserwowani
        </li>
        <li>
          <i class="bi bi-x-circle"></i>
          Cały postęp i poziom XP
        </li>
        <li>
          <i class="bi bi-x-circle"></i>
          Zdjęcie profilowe i wszystkie dane osobowe
        </li>
      </ul>
    </div>

    <form method="POST" id="deleteForm">
      {% csrf_token %}

      <div class="form-group-delete">
        <label class="form-label-delete">Potwierdź hasło</label>
        <input 
          type="password" 
          class="form-control-delete" 
          name="password"
          id="password-input"
          required
          placeholder="Wpisz swoje hasło">
        <div class="form-hint">
          <i class="bi bi-shield-lock"></i>
          Wymagane w celu potwierdzenia tożsamości
        </div>
      </div>

      <div class="form-group-delete">
        <label class="form-label-delete">
          Wpisz: <span style="color: #ef4444; font-family: monospace;">USUŃ KONTO</span>
        </label>
        <input 
          type="text" 
          class="form-control-delete" 
          name="confirm_text"
          id="confirm-input"
          required
          placeholder="USUŃ KONTO"
          autocomplete="off">
        <div class="form-hint">
          <i class="bi bi-keyboard"></i>
          Przepisz dokładnie, wielkość liter ma znaczenie
        </div>
      </div>

      <div class="action-buttons-delete">
        <a href="{% url 'account_settings' %}" class="btn-cancel-delete">
          <i class="bi bi-arrow-left"></i>
          Anuluj
        </a>
        <button type="submit" class="btn-delete-confirm" id="deleteBtn" disabled>
          <i class="bi bi-trash-fill"></i>
          Usuń konto na zawsze
        </button>
      </div>

    </form>
  </div>

</div>

<script>
(function() {
  const form = document.getElementById('deleteForm');
  const passwordInput = document.getElementById('password-input');
  const confirmInput = document.getElementById('confirm-input');
  const deleteBtn = document.getElementById('deleteBtn');

  function checkForm() {
    const password = passwordInput.value;
    const confirmText = confirmInput.value;
    
    // Enable button only if both fields are filled
    if (password && confirmText === 'USUŃ KONTO') {
      deleteBtn.disabled = false;
    } else {
      deleteBtn.disabled = true;
    }
  }

  passwordInput.addEventListener('input', checkForm);
  confirmInput.addEventListener('input', checkForm);

  form.addEventListener('submit', function(e) {
    const confirmText = confirmInput.value;
    
    if (confirmText !== 'USUŃ KONTO') {
      e.preventDefault();
      alert('Musisz wpisać dokładnie: USUŃ KONTO');
      return;
    }

    if (!confirm('Czy NA PEWNO chcesz usunąć swoje konto? Tej operacji nie można cofnąć!')) {
      e.preventDefault();
      return;
    }
  });
})();
</script>

{% endblock %}