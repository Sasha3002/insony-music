{% extends "users/base.html" %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/users.css' %}">
{% endblock %}

{% block content %}

<div id="profileEditPage"></div>
<div class="container py-4">
  <div class="edit-hero">
    <h1 class="page-title-edit">
      <i class="bi bi-pencil-square"></i>
      Edytuj profil
    </h1>
    <p class="page-subtitle">Zaktualizuj swoje informacje i preferencje muzyczne</p>
  </div>

  <script type="application/json" id="genresData">{{ all_genres_json|safe }}</script>
  <script type="application/json" id="artistsData">{{ all_artists_json|safe }}</script>

  <form method="POST" enctype="multipart/form-data" class="form-card">
    {% csrf_token %}

    <!-- Avatar Section -->
    <div class="avatar-section">
      <div class="avatar-preview" id="avatar-preview">
        {% if user.profile_picture %}
          <img src="{{ user.profile_picture.url }}" alt="{{ user.username }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
        {% else %}
          {{ user.username|slice:":1"|upper }}
        {% endif %}
      </div>
      <div class="avatar-info" style="flex: 1;">
        <h4>{{ user.username }}</h4>
        <p>Dołączył {{ user.date_joined|date:"d F Y" }}</p>
        
        <div style="margin-top: 12px;">
          <label for="picture-upload" class="btn-upload">
            <i class="bi bi-camera"></i>
            Zmień zdjęcie
          </label>
          <input 
            type="file" 
            id="picture-upload" 
            name="profile_picture" 
            accept="image/*"
            style="display: none;">
          
          {% if user.profile_picture %}
          <button type="button" class="btn-remove-picture" id="remove-picture">
            <i class="bi bi-trash"></i>
            Usuń zdjęcie
          </button>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Personal Information Section -->
    <div class="form-section-title">
      <i class="bi bi-person"></i>
      Informacje osobiste
    </div>

    <div class="form-grid">
      <div class="form-group">
        <label class="form-label-modern">Imię</label>
        <input 
          type="text" 
          class="form-control-modern" 
          name="first_name" 
          value="{{ first_name }}"
          placeholder="Twoje imię">
      </div>

      <div class="form-group">
        <label class="form-label-modern">Nazwisko</label>
        <input 
          type="text" 
          class="form-control-modern" 
          name="last_name" 
          value="{{ last_name }}"
          placeholder="Twoje nazwisko">
      </div>

      <div class="form-group form-grid-full">
        <label class="form-label-modern">Email</label>
        <input 
          type="email" 
          class="form-control-modern" 
          name="email" 
          value="{{ email }}" 
          required
          placeholder="twoj@email.com">
        <div class="form-text-modern">
          <i class="bi bi-info-circle"></i>
          Używany do logowania i powiadomień
        </div>
      </div>

      <div class="form-group form-grid-full">
        <label class="form-label-modern">
          <i class="bi bi-geo-alt"></i> Miasto
        </label>
        <input 
          type="text" 
          class="form-control-modern" 
          name="city" 
          value="{{ city|default:'' }}"
          placeholder="np. Warszawa, Kraków, Online..."
          maxlength="200">
        <div class="form-text-modern">
          <i class="bi bi-info-circle"></i>
          Twoje miasto zamieszkania (opcjonalne)
        </div>
      </div>
    </div>

    <!-- Music Preferences Section -->
    <div class="form-section-title" style="margin-top: 32px;">
      <i class="bi bi-music-note-beamed"></i>
      Preferencje muzyczne
    </div>

    <div class="form-grid">
      <!-- Genres Autocomplete -->
      <div class="form-group form-grid-full">
        <label class="form-label-modern">Ulubione gatunki</label>
        <div class="autocomplete-wrapper">
          <input 
            type="text" 
            class="form-control-modern" 
            id="genres-search"
            placeholder="Zacznij pisać aby wyszukać gatunek..."
            autocomplete="off">
          <div class="autocomplete-dropdown" id="genres-dropdown"></div>
        </div>
        <div class="form-text-modern">
          <i class="bi bi-info-circle"></i>
          Wpisz nazwę gatunku i wybierz z listy
        </div>
        
        <!-- Selected Tags -->
        <div class="selected-tags" id="genres-tags"></div>
        
        <!-- Hidden input for form submission -->
        <input type="hidden" name="favorite_genres" id="genres-hidden" value="{{ favorite_genres }}">
      </div>

      <!-- Artists Autocomplete -->
      <div class="form-group form-grid-full">
        <label class="form-label-modern">Ulubieni artyści</label>
        <div class="autocomplete-wrapper">
          <input 
            type="text" 
            class="form-control-modern" 
            id="artists-search"
            placeholder="Zacznij pisać aby wyszukać artystę..."
            autocomplete="off">
          <div class="autocomplete-dropdown" id="artists-dropdown"></div>
        </div>
        <div class="form-text-modern">
          <i class="bi bi-info-circle"></i>
          Wpisz nazwę artysty i wybierz z listy
        </div>
        
        <!-- Selected Tags -->
        <div class="selected-tags" id="artists-tags"></div>
        
        <!-- Hidden input for form submission -->
        <input type="hidden" name="favorite_artists" id="artists-hidden" value="{{ favorite_artists }}">
      </div>
    </div>

    <!-- Bio Section -->
    <div class="form-section-title" style="margin-top: 32px;">
      <i class="bi bi-chat-quote"></i>
      O mnie
    </div>

    

    <div class="form-group">
      <label class="form-label-modern">Bio</label>
      <textarea 
        class="form-control-modern" 
        name="bio" 
        id="bio-input"
        rows="5"
        maxlength="500"
        placeholder="Opowiedz coś o sobie i swoich muzycznych pasjach...">{{ bio }}</textarea>
      <div class="char-counter">
        <span id="bio-count">0</span> / 500 znaków
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <a class="btn-cancel" href="{% url 'profile' %}">
        <i class="bi bi-x-circle"></i>
        Anuluj
      </a>
      <button type="submit" class="btn-save">
        <i class="bi bi-check-circle"></i>
        Zapisz zmiany
      </button>
    </div>
  </form>
</div>

{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/users.js' %}"></script>
{% endblock %}